<ng-container *ngIf="state$ | async as state">
  <form [formGroup]="form">
    <table class="calc-table">
      <tbody>
        <tr>
          <td colspan="3">
            <div class="pokemon-base-info">
              <pokemon-select formControlName="pokemon"></pokemon-select>
              <a
                [href]="state.pokemon.url"
                target="_blank"
                title="ポケモン徹底攻略で{{ state.pokemon.name }}を見る"
                class="info-link"
              >
                <img src="assets/images/yakkun-32x32.png" width="16px" height="16px" />
              </a>
            </div>
          </td>
        </tr>
        <tr>
          <td>Lv</td>
          <td colspan="2">
            <level-input formControlName="level"></level-input>
          </td>
        </tr>
        <tr>
          <td>性格</td>
          <td colspan="2">
            <nature-select formControlName="nature"></nature-select>
          </td>
        </tr>
        <tr>
          <td></td>
          <td class="value-label">種族値</td>
          <td class="value-label">能力値</td>
          <td class="value-label">努力値</td>
          <td class="value-label">個体値</td>
        </tr>
        <tr formGroupName="H">
          <td class="stat-name">H</td>
          <td class="base-stat">{{ state.pokemon.baseStats[0] }}</td>
          <td>
            <stat-input formControlName="stat" [isMin]="state.evs[0] === 0" [isMax]="state.evs[0] === 252"></stat-input>
          </td>
          <td><ev-input formControlName="ev"></ev-input></td>
          <td><iv-input formControlName="iv"></iv-input></td>
        </tr>
        <tr
          formGroupName="A"
          [class.stat-nature-up]="state.nature.up === 'A'"
          [class.stat-nature-down]="state.nature.down === 'A'"
        >
          <td class="stat-name">A</td>
          <td class="base-stat">{{ state.pokemon.baseStats[1] }}</td>
          <td>
            <stat-input formControlName="stat" [isMin]="state.evs[1] === 0" [isMax]="state.evs[1] === 252"></stat-input>
          </td>
          <td><ev-input formControlName="ev"></ev-input></td>
          <td><iv-input formControlName="iv"></iv-input></td>
        </tr>
        <tr
          formGroupName="B"
          [class.stat-nature-up]="state.nature.up === 'B'"
          [class.stat-nature-down]="state.nature.down === 'B'"
        >
          <td class="stat-name">B</td>
          <td class="base-stat">{{ state.pokemon.baseStats[2] }}</td>
          <td>
            <stat-input formControlName="stat" [isMin]="state.evs[2] === 0" [isMax]="state.evs[2] === 252"></stat-input>
          </td>
          <td><ev-input formControlName="ev"></ev-input></td>
          <td><iv-input formControlName="iv"></iv-input></td>
        </tr>
        <tr
          formGroupName="C"
          [class.stat-nature-up]="state.nature.up === 'C'"
          [class.stat-nature-down]="state.nature.down === 'C'"
        >
          <td class="stat-name">C</td>
          <td class="base-stat">{{ state.pokemon.baseStats[3] }}</td>
          <td>
            <stat-input formControlName="stat" [isMin]="state.evs[3] === 0" [isMax]="state.evs[3] === 252"></stat-input>
          </td>
          <td><ev-input formControlName="ev"></ev-input></td>
          <td><iv-input formControlName="iv"></iv-input></td>
        </tr>
        <tr
          formGroupName="D"
          [class.stat-nature-up]="state.nature.up === 'D'"
          [class.stat-nature-down]="state.nature.down === 'D'"
        >
          <td class="stat-name">D</td>
          <td class="base-stat">{{ state.pokemon.baseStats[4] }}</td>
          <td>
            <stat-input formControlName="stat" [isMin]="state.evs[4] === 0" [isMax]="state.evs[4] === 252"></stat-input>
          </td>
          <td><ev-input formControlName="ev"></ev-input></td>
          <td><iv-input formControlName="iv"></iv-input></td>
        </tr>
        <tr
          formGroupName="S"
          [class.stat-nature-up]="state.nature.up === 'S'"
          [class.stat-nature-down]="state.nature.down === 'S'"
        >
          <td class="stat-name">S</td>
          <td class="base-stat">{{ state.pokemon.baseStats[5] }}</td>
          <td>
            <stat-input formControlName="stat" [isMin]="state.evs[5] === 0" [isMax]="state.evs[5] === 252"></stat-input>
          </td>
          <td><ev-input formControlName="ev"></ev-input></td>
          <td><iv-input formControlName="iv"></iv-input></td>
        </tr>
      </tbody>
    </table>
  </form>

  <textarea class="stats-text" [value]="state.statsText" (click)="copyText()" readonly></textarea>
</ng-container>
